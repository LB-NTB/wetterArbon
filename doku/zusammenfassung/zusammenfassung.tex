
\documentclass[10pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{geometry}
\geometry{a4paper, top=20mm, left=20mm, right=20mm, bottom=20mm,
headsep=10mm, footskip=12mm}
\usepackage{multicol}
\setlength{\columnsep}{0.5cm}
 
\begin{document}
\begin{multicols}{2}
[
%  Title and authors
    \begin{center}
      {\huge\sffamily Multiplattform-fähiges und barrierefreies User Interface und Datenmanagement für die Wetterstation Arbon}\\
       \vspace{2ex}
       \textsc{Ladina Bilgery und Thomas Wieling}
    \end{center}
]

%Einleitung
Die Wetterstation Arbon wurde 2005 als Lehrlingsarbeit des Berufsbildungszentrums Arbon auf Initiative der Technischen Gesellschaft Arbon (TGA) aufgebaut und in Betrieb genommen. Diese bestand aus mehreren Wettersensoren und einer Webcam, die auf einer Plattform auf dem See draussen montiert waren. Aus technischen Gründen wurde die Wetterstation Ende 2013 ausser Betrieb genommen und im Jahre 2015 von einigen Interessenten wieder in Betrieb genommen, hierbei wurde ein Teil durch Standard Hard- und Software ersetzt.\\
Während der Bachelor-Arbeit wurden diverse Modernisierungen und Funktionserweiterungen hinzugefügt, sowie Adobe Flash ersetzt. Die Arbeit wurde in sechs Blöcke unterteilt: Hardware, Webseite, Server, Programmierschnittstelle (API), Alarm-Meldungen (Benachrichtigungsservice) und Webcam.\\
%Aufbau und deren Sensoren
Die Wetterstation Arbon verfügt über fünf Sensor-Einheiten: Webcam, Kombi-Wetter-Transmitter, Wassertemperatur-Sensoren, Pegelsensor und Sonnenstrahlungssensor. Während der Arbeit wurde der Pegel- und Strahlungssensor ersetzt beziehungsweise hinzugefügt. Der Pegelsensor dient zur Messung des Pegelstandes vom Bodensee. Der Strahlungssensor liefert die Daten für die Sonnenscheindauer und gibt gleichzeitig Hinweise auf Zeit und Stärke der Bewölkung.\\ 
Der Pyranometer basiert auf dem Messprinzip eines Thermoelements. Die eintreffende Strahlung welche auf einen Absorber trifft, misst die Strahlung, hiermit kann die (relative) Sonnenscheindauer bestimmt werden. Der Zähler für die Sonnenstunden wird um eine Minute erhöht, wenn der Messwert grösser ist als der Schwellwert, welcher aus einer Formel hervorgeht. Da die Strahlungsintensität von Buchs und Arbon vergleichbar sind (gleiche geografische Breite und Höhe), wurden die Koeffizienten, in der Formel, vom NTB direkt übernommen.\\
Die ursprüngliche Wetterstation verwendete einen hydrostatischen Drucksensor für die Messung des Wasserstands (Pegel). Der Drucksensor lieferte aber keine plausiblen Werte mehr, weshalb er ersetzt werden musste. Für die Messung des Bodensee-Pegels wurden verschiedene Messprinzipien verglichen, mit dem Hintergedanken die Pegelmesswerte ebenfalls zur Messung der Wellenhöhe verwenden zu können. Jedoch überwog hier die Einfachheit und Robustheit des hydrostatischen Sensors, sodass der alte Drucksensor durch das gleiche Produkt ersetzt wurde. Der Pegel- und Strahlung-Sensor ist an einem Web-Interface angeschlossen, welches den Strom-Messwert über eine Web-Schnittstelle zur Verfügung stellt und mittels einer Formel in die zu bestimmende Einheit umgerechnet wird. Ursprünglich war geplant mit dem Pegelsensor ebenfalls die Wellenhöhe zu messen. Dies ist aber aus technischen Gründen nicht möglich.\\ 
Weiter beherbergt die Wetterstation acht Wasser-Temperatursensoren (PT100-Elemente) über welche die offizielle Wassertemperatur einen Meter sowie für die Schwimmer einen halben Meter unter der Wasseroberfläche, gemessen wird. Die Web-Schnittstelle basiert auf dem Prinzip wie beim Pegelsensor. Mit dem Unterschied, dass hier direkt die Temperatur berechnet wird. Der fünfte Sensor liefert ein falsches Messergebnis mit einem Offset konnte dies jedoch korrigiert werden.\\
%Frontend
Die bisherige Anzeige der Wetterdaten basiert auf Adobe Flash, was nicht von allen Browsern unterstützt wird. Die neue HTML5-Spezifikation ermöglicht, dynamische Grafiken zu erzeugen, von allen Web-Browsern dargestellt werden können. Die bestehende Webseite wurde mittels Google Analytics analysiert. Darin lässt sich erkennen, dass der grossteil der Nutzer mobile Geräte verwenden. Aus diesem Grund wurde in diesem Projekt die mobile Seite als Ausgangspunkt für die Entwicklung der Homepage nach dem Designkonzept \textit{Mobile First} gesetzt. Zudem zeigte sich beim erstellen der Designentwürfe, dass die einfachste Möglichkeit, die Daten auf allen Bildschirmgrössen darzustellen, die Informationen in kleine logische Blöcke zu unterteilen. Somit ist die Benutzeroberfläche auch Cross-Plattform-fähig. Mittels dem \textit{W3schools} CSS, der \textit{ICONBIB.} Icon-Bibliothek, der \textit{GAUGESBIB} und \textit{chartist} JS-Bibliothek konnte das Design für die Anzeige der aktuellen Werte wunschgemäss umgesetzt werden.
%Die Wetterverlaufsdarstellung soll einen Überblick über die Wettertendenz der letzten beiden Tage liefern. Die Samplerate beträgt 1h, d.h. die Daten werden aus der Tabelle der historischen Werte abgerufen. Für die Darstellung der Messwertverläufe soll ebenfalls auf eine Bibliothek zurückgegriffen werden. Zur Verlaufsdarstellung wird primär das Linien- und Balkendiagramm verwendet, wie in Abbildung \ref{img:charts} aufgezeigt. Für jede Grafik wurde entschieden, ob eine automatische Y-Achs-Skalierung sinnvoll ist oder nicht. Bei der Windgeschwindigkeit und beim Pegel wird bewusst eine fixe Skalierung verwendet, damit auf den ersten Blick klar ist, ob der Wert eher hoch oder tief ist. Beim Luftdruck hingegen ist die Tendenz wichtig, weshalb möglichst die gesamte Höhe des Diagramms genutzt werden soll. Es wird daher eine automatische Y-Achs-Skalierung verwendet. Die Anzeige des Windrichtungsverlaufs ist nicht ganz trivial, da sie von 0 bis 360 Grad geht und ohne Unterbruch wieder zu 0 Grad. In der Praxis wird dazu häufig die Darstellung von Pfeilen verwendet, wie in Abbildung \ref{img:windrichtung}, links dargestellt. Es konnte jedoch keine Bibliothek gefunden werden, das diese Darstellungsart als Template zur Verfügung stellt. Die Anzeige der Windrichtung wird deshalb über ein Punktdiagramm, wie in Abbildung \ref{img:windrichtung}, rechts dargestellt, verwendet. 
Zusätzlich zu den aktuellen Werten wird der Wind mit einem kostenlosen Vorhersagediensten verglichen. Zudem wurde die Sturmwarnung auf dem Bodensee integriert, wobei die Daten von der Seite der Kantonspolizei stammen. Damit eine geöffnete Webseite immer auf dem aktuellen Stand ist, wird eine poll-Funktion verwendet. Die gesamte Aktualisierung wird asynchron mittels AJAX durchgeführt. Die Seite wird dabei nicht neu geladen, sondern nur die Anzeigewerte. Nebst den aktuellen Werten können auch die folgenden historische Daten, historische Daten der neuen Wetterstation (2015 bis heute), historische Daten der alten Wetterstation (2005 bis 2012) und Exceltabelle mit historischen Pegeldaten (1953 bis 2005) eingesehen werden. Dazu wurde mit Tableau Public, ein Daten-Visualisierungsprogramm, Diagramme erstellt, welche interaktiv vom Benutzer Filterbar sind.\\ 
Zusätzlich zu den neuen Anzeigen sollte die Webseite gestaltet werden, dass sie möglichst für alle Benutzergruppen zugänglich ist. Die aktuellen \emph{Web Content Accessibility Guidelines} fordern die Einhaltung von vier Designprinzipien. Aus den Richtlinien wurden diejenigen Anforderungen ausgewählt, die auf die Webseite der Wetterstation anwendbar und die im Rahmen des CMS umsetzbar sind. \\
%Backend
Auch bei der  Serverseite wurden diverse Neuerungen vorgenommen, da diese die Schnittstelle zwischen dem Client und den Messdaten bildet. Die Sensoren werden in regelmässigen Abständen abgerufen und in der Datenbank gespeichert werden. Hierbei ist bei der Modernisierung die Datenbank zum Herzstück der Wetterstation geworden. Diese muss somit entsprechend geschützt werden vor Datenverlust und oder -manipulation. Hierfür wurden die Abfrage der einzelnen Daten, mit Ausnahme der Messwerten des Kombi-Wettertransmitters Skripte durchgeführt. Diese Daten werden weiterhin von WeatherDisplay über eine virtuelle serielle Schnittstelle abgerufen, aufbereitet und im Minutentakt in die Datenbank gespeichert. Bei den externen Sensordaten wird im Skript schon kontrolliert ob ein Datenbankeintrag erstellt werden konnte. Dies geschieht, indem sämtliche Aufgaben in den Python-Skripten in einem try...catch-Verfahren ausgeführt werden. Da das Auslesen des Kombi-Wettertransmitters nicht mittels Cronjob durchgeführt wird gibt es die Möglichkeit des Exeption-Handlings nicht. Als Alternative wird aber beim Erstellen der historischen Daten kontrolliert, ob alle 60 Einträge der letzten Stunde vorhanden sind. Weiter werden SQL-Abfragen mittels \emph{Prepared Statements} durchgeführt und die Benutzereingaben \emph{escaped}. Die Sturmwarndaten, sowie die Windvorhersagen werden periodisch mittels einem Python-Skript ausgelesen und in die Datenbank geschrieben.\\
Die Datenbank besteht aus mehreren Tabellen mit unterschiedlichem Inhalt, für die Datenspeicherung stellt der Webhosting-Provider der Wetterstation, eine Datenbank des Typs MariaDB Version 10.1 mit dem Administrationstool phpMyAdmin zur Verfügung. Die Tabellen haben untereinander keine Relation, sondern sind alle eigenständig. Das einzige, was sie verbindet ist der Zeitstempel des Messzeitpunkts. Damit für die historische Anzeige, nicht alle der 21 Millionen pro Jahr anfallenden Datensätze laden muss, werden die Messdaten periodisch zusammengefasst. Die minütlich gespeicherten Messdaten werden einmal pro Stunde zusammengefasst und in die historische Tabelle\emph{tblhistorical} geschrieben. Dies wird nicht mit einem direkten Tabellen zugriff umgesetzt sondern mittels einer VIEW, die beiden VIEWs, welche für die Aggregation benötigt werden beinhalten jeweils genau 60 Einträge.\\
Da die Wetterstation viele repetitive Aufgaben ausführen muss werden sämtliche Skripte mittels Cronjob aufgeführt. Hierfür  bietet Hostpoint mit dem Cron-Daemon ein Werkzeug um zeitbasiert Befehle beziehungsweise Skripte auszuführen. Die erwähnten Cronjobs sind die wichtigsten, werden diese nicht durchgeführt, werden auch keinen Daten ausgelesen bzw. erstellt. Zudem bietet Hostpoint die Möglichkeit, dass sämtliche Textausgaben (print-Funktion) eines Cronjobs an eine bestimmte Mailadresse gesendet werden.\\
Um die Datenbank gegen einen allfälligen Datenverlust zu sichern und den Aufwand klein zu halten, wird empfohlen ein monatliches Backup mit der manuellen Backup Funktion zu erstellen und dieses auf einer Festplatte zu speichern.
%API
Um die Kommunikation von Server zu Server zu vereinfachen werden maschinenlesbare Schnittstellen eingesetzt, sogenannte application programming interfaces (API). Die API wurde deshalb in folgende drei Kategorien, Messdaten (data), Zusatzinformationen (misc), Webcam-Links (webcam), aufgeteilt. \emph{Data} ist für die direkten bzw. indirekten Messdaten der Wetterstation vorgesehen. Unter \emph{misc} werden Daten von dritten beherbergt . Unter \emph{webcam} werden Links für die Webcam zur Verfügung gestellt. Die Struktur wurde so gewählt, dass sie logisch ist, sich beliebig erweitern lässt und die URL trotzdem möglichst kurz ist. Die URL entspricht zudem genau dieser hierarchischen Datenstruktur. Die API wurde wie Heutzutage üblich nach dem RESTful Prinzip entwickelt. Zudem werden bei der Wetterstation nur die GET-Methode verwendet, da die API ein read-only-Dienst darstellt. Die Versionierung URL wurde nach der semantischen Versionierung erstellt, um die Kompatibilität zu gewährleisten wurde die MAJOR-Nummer in die URL der API aufgenommen. Damit sich die Computer gegenseitig verstehen, ist es wichtig, dass die Kommunikation in einem standardisierten Datenformat erfolgt. Als Datenformat der API wurde JSON gewählt, hierbei handelt es sich um simples und im Webbereich häufig eingesetztes Datenformat. Die API ist komplett in php geschrieben werden, da Hostpoint kein serverseitiges Javascript erlaubt und ohne Framework aufgebaut, da sich dies aus der Nutzwertanalyse und der Grösse der API so ergeben hat. Serverseitig wurde die API aus hierarchischer Sicht von unten nach oben entwickelt, die Abfrage auf die Informationseinheit bildet somit den Kern der API, zudem wurde die Dateistruktur nach dem MVC-Prinzip aufgebaut. Die ganze API ist so aufgebaut, so dass sie für weitere Anwendungen oder Messwerte ausbauen lässt. Die Dokumentation wurde in Postman dokumentiert und ist öffentlich zugänglich. Dabei werden sämtliche Endpunkte, die von der API zur Verfügung gestellt werden aufgelistet und erklärt. Zudem wird die Dokuseite automatisch aufgerufen wenn sich in der URL-Anfrage auf \texttt{api.wetter-arbon.ch} ein Fehler befindet.\\
%Notifications
Die Idee hinter dem Benachrichtigungsservice ist, dass mit dem  Formular des Benachrichtigungsservices welches aus vier Eingabe- bzw. Auswahlfeldern besteht, der Benutzer per Mail informiert wird, sobald der von ihnen definierte Grenzwert über- bzw. unterschritten wird.  Dieser ist so aufgebaut, dass auf der Webseite das Formular mit den gewünschten Daten ausgefüllt werden kann und es ohne Benutzeraccount funktioniert. Deswegen wird in jedem Mail, welches versendet wird, ein Unsubscribe-Link mitgeschickt. So kann der Benutzer den Service selbständig wieder löschen. Der Benachrichtigungsservice selbst basiert auf einem Cronjob, der einmal pro Stunde läuft. Unter HTML5 ist die Formularüberprüfung direkt in die Formularfelder integriert, welches die Überprüfung in PHP überflüssig macht. Die angegebenen Daten werden, zusammen mit dem status aktiv oder inaktiv sowie den Zeitstepmel des letzen Mails in einer Tabelle für das Abo gespeichert. Das Benachrichtigungs-E-Mail wird als sogenanntes \emph{MIMEMultipart}-Mail versendet.

%Webcam
Bei der Webcam der Wetterstation handelt es sich um eine dreh-, schwenk- und zoombare Netzwerk-Kamera. Die Webseite bietet die Möglichkeit die Webcam über den Browser zu steuern, sind mehrere Nutzer gleichzeitig auf der Seite können sie sich gegenseitig beim Navigieren stören, deswegen wurde eine Warteschlange implementiert. Der Benutzer registriert sich per Klick auf den Registrierungsbutton, so wird eine Session-ID gelöst und diese per POST an den Server gesendet. Anschliessend wird in einem PHP File seine Wartezeit berechnet und zurück gegeben. Sind bereits andere Benutzer in der Warteschlange, so wird unterhalb des Registrierungsbuttons ein roter Balken mit der Wartezeit angezeigt. Ist der Benutzer an der Reihe wird die verbleibende Zeit mit einem grünen Balken, angezeigt. Das Löschen des Datenbankeintrags erfolgt automatisch nach 10 Minuten.
\end{multicols}
 
\end{document}

